<div
  class="answer-question"
  [ngClass]="{
    'question-read': hasUserRead,
    'question-unread': !hasUserRead,
    'question-answered': currentUserTotalAnswers
  }"
>
  <div class="question">{{ question.text }}</div>
  <div *ngIf="!answerFormVisible" class="actions">
    <button
      *ngIf="!currentUserTotalAnswers && !isAdministrator"
      mdc-button
      primary
      (click)="showAnswerForm()"
      id="add-answer"
    >
      Add Answer
    </button>
  </div>
</div>
<div *ngIf="answerFormVisible">
  <form [formGroup]="answerForm" autocomplete="off" id="answer-form">
    <mdc-tab-bar #answerTabs fixed>
      <mdc-tab-scroller>
        <mdc-tab icon="title" label="Answer"></mdc-tab>
        <mdc-tab icon="mic" label="Record"></mdc-tab>
        <mdc-tab icon="cloud_upload" label="Upload"></mdc-tab>
        <mdc-tab icon="text_rotation_none" label="Select Text" disabled></mdc-tab>
      </mdc-tab-scroller>
    </mdc-tab-bar>
    <div *ngIf="answerTabs.activeTabIndex === 0" class="answer-tab answer-text">
      <mdc-form-field>
        <mdc-text-field
          label="Your Answer"
          type="text"
          formControlName="answerText"
          outlined
          [value]="activeAnswer?.text"
        ></mdc-text-field>
      </mdc-form-field>
    </div>
    <div *ngIf="answerTabs.activeTabIndex === 1" class="answer-tab answer-record">
      <app-checking-audio-recorder (status)="recorderStatus($event)"></app-checking-audio-recorder>
    </div>
    <div *ngIf="answerTabs.activeTabIndex === 2" class="answer-tab answer-upload">
      <button
        *ngIf="!uploadAudioFileUrl"
        mdc-button
        ngfSelect
        [(file)]="uploadAudioFile"
        (fileChange)="prepareAudioFileUpload()"
        accept="audio/*"
        class="upload-audio-file"
      >
        <mdc-icon>cloud_upload</mdc-icon>
        Upload Audio File
      </button>
      <button *ngIf="uploadAudioFileUrl" mdc-button (click)="resetAudioFileUpload()" class="remove-audio-file">
        <mdc-icon>delete</mdc-icon>
        Remove Audio File
      </button>
      <app-checking-audio-player [source]="uploadAudioFileUrl"></app-checking-audio-player>
    </div>
    <div *ngIf="answerTabs.activeTabIndex === 3" class="answer-tab answer-upload">Coming soon</div>
    <div *ngIf="answerFormSubmitAttempted && answerForm.invalid" class="form-helper-text">
      You need to enter your answer or record your answer before saving
    </div>
    <div class="form-actions">
      <button mdc-button (click)="hideAnswerForm()" id="cancel-answer">Cancel</button>
      <button mdc-button primary form="answer-form" id="save-answer" (click)="submit()">Save Answer</button>
    </div>
  </form>
</div>
<div class="answers-container">
  <ng-container *ngIf="!answerFormVisible && answers.length && (currentUserTotalAnswers || isAdministrator)">
    <h3>{{ totalAnswersHeading }}</h3>
    <div class="answer" *ngFor="let answer of answers" [ngClass]="{ 'answer-unread': !hasUserReadAnswer(answer) }">
      <div class="like">
        <mdc-icon id="like-answer" (click)="likeAnswer(answer)">thumb_up</mdc-icon
        ><span class="like-count">{{ answer.likes.length }}</span>
      </div>
      <div class="answer-detail">
        <div *ngIf="answer.text" class="answer-text">{{ answer.text }}</div>
        <app-checking-audio-player
          *ngIf="answer.audioUrl"
          [source]="answer.audioUrl"
          [downloadable]="canDownloadAudioFiles"
        ></app-checking-audio-player>
        <div class="answer-footer">
          <div class="actions">
            <button *ngIf="hasPermission(answer, 'edit')" mdc-button (click)="editAnswer(answer)" class="answer-edit">
              Edit
            </button>
            <button
              *ngIf="hasPermission(answer, 'delete')"
              mdc-button
              (click)="deleteAnswer(answer)"
              class="answer-delete"
            >
              Delete
            </button>
          </div>
          <app-checking-owner
            [ownerRef]="answer.ownerRef"
            [includeAvatar]="true"
            [layoutStacked]="true"
            [dateTime]="answer.dateCreated"
          ></app-checking-owner>
        </div>
        <app-checking-comments
          [projectCurrentUser]="projectCurrentUser"
          (action)="submitCommentAction($event)"
          [comments]="getComments(answer)"
          [answer]="answer"
        ></app-checking-comments>
      </div>
    </div>
  </ng-container>
</div>
