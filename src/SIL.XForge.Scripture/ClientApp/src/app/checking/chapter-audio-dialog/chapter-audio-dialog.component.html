<ng-container *transloco="let t">
  <h2 mat-dialog-title>Chapter Audio</h2>
  <mat-dialog-content class="mat-typography">
    <div class="dropzone" #dropzone>
      <input type="file" multiple #fileDropzone accept=".csv,.tsv,.txt,audio/*" (change)="uploadedFiles($event)" />
      <label
        >Drag and drop audio and timing files here<br />
        - OR -
      </label>
      <button mat-flat-button color="primary" type="submit">Browse Files</button>
    </div>
    <div class="data-blocks">
      <div class="wrapper valid">
        <mat-select [(value)]="book" class="book-select-menu">
          <mat-option *ngFor="let b of books" [value]="b">{{ bookName(b) }}</mat-option>
        </mat-select>
        <div class="divider"></div>
        <mat-select [(value)]="chapter" class="chapter-select-menu">
          <mat-option *ngFor="let c of chapters" [value]="c">{{ c }}</mat-option>
        </mat-select>
      </div>
      <app-notice class="" *ngIf="selectionHasAudioAlready" icon="warning" type="warning"
        >{{ t("checking_audio_dialog.audio_already_exists") }}
      </app-notice>
      <div class="wrapper" [ngClass]="{ valid: hasAudioBeenUploaded }">
        <ng-container *ngIf="hasAudioBeenUploaded">
          <app-single-button-audio-player
            #chapterAudio
            id="chapterAudio"
            [source]="audioBlob"
            (click)="chapterAudio.playing ? chapterAudio.stop() : chapterAudio.play()"
          >
            <mat-icon>{{ chapterAudio.playing ? "stop" : "play_arrow" }}</mat-icon>
          </app-single-button-audio-player>
          <span *ngIf="hasAudioBeenUploaded">{{ audioFilename }}</span>
          <mat-icon *ngIf="hasAudioBeenUploaded" (click)="deleteAudioData()" class="delete">delete</mat-icon>
        </ng-container>
        <ng-container *ngIf="!hasAudioBeenUploaded">
          <mat-icon>play_disabled</mat-icon>
          <span>No audio file uploaded</span>
        </ng-container>
      </div>
      <div class="wrapper" [ngClass]="{ valid: hasTimingBeenUploaded }">
        <mat-icon class="material-icons-outlined">timer</mat-icon>
        <span *ngIf="hasTimingBeenUploaded">{{ numberOfTimingSegments }} segments found</span>
        <span *ngIf="!hasTimingBeenUploaded">No timing data uploaded</span>
        <mat-icon *ngIf="hasTimingBeenUploaded" (click)="deleteTimingData()" class="delete">delete</mat-icon>
      </div>
      <app-notice class="" *ngIf="errorMessage !== ''" icon="error" type="error">{{ t(errorMessage) }} </app-notice>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions>
    <div class="uploading" *ngIf="isLoadingAudio">
      <span>Uploading...</span>
      <mat-spinner diameter="24"></mat-spinner>
    </div>
    <button mat-button [mat-dialog-close]="'close'" type="button" id="audio-cancel-btn">
      {{ t("checking_audio_dialog.cancel") }}
    </button>
    <button mat-flat-button color="primary" type="submit" (click)="save()" id="audio-save-btn">
      {{ t("checking_audio_dialog.save") }}
    </button>
  </mat-dialog-actions>
</ng-container>
