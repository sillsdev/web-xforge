<mat-card *transloco="let t; read: 'draft_generation'">
  <h1 mat-card-title>{{ t("generate_back_translation_drafts") }}</h1>

  <mat-divider inset></mat-divider>

  <section>
    <p>{{ t("scripture_forge_assist") }}</p>
    <p><transloco key="draft_generation.keep_in_mind"></transloco></p>
    <p>{{ t("back_translation_process") }}</p>

    <!-- TODO Find better link to languages or include in-app table with link to "learn more" -->
    <h3 class="requirements-header">{{ t("requirements") }}</h3>
    <ul class="requirements">
      <li>
        <mat-icon *ngIf="isBackTranslation" class="criteria-met">check</mat-icon>
        <mat-icon *ngIf="!isBackTranslation" class="criteria-not-met">clear</mat-icon>
        <p *ngIf="isBackTranslation">{{ t("project_type_back_translation") }}</p>
        <p *ngIf="!isBackTranslation">{{ t("project_type_not_back_translation") }}</p>
      </li>
      <li>
        <mat-icon *ngIf="isTargetLanguageSupported" class="criteria-met">check</mat-icon>
        <mat-icon *ngIf="!isTargetLanguageSupported" class="criteria-not-met">clear</mat-icon>
        <p>
          <transloco
            *ngIf="!isTargetLanguageSupported && targetLanguageDisplayName"
            key="draft_generation.project_language_in_nllb_with_language"
            [params]="{ targetLanguageDisplayName, nllbUrl }"
          ></transloco>
          <transloco
            *ngIf="!isTargetLanguageSupported && !targetLanguageDisplayName"
            key="draft_generation.project_language_in_nllb"
            [params]="{ nllbUrl }"
          ></transloco>
          <transloco
            *ngIf="isTargetLanguageSupported && targetLanguageDisplayName"
            key="draft_generation.project_language_not_in_nllb_with_language"
            [params]="{ targetLanguageDisplayName, nllbUrl }"
          ></transloco>
          <transloco
            *ngIf="isTargetLanguageSupported && !targetLanguageDisplayName"
            key="draft_generation.project_language_not_in_nllb"
            [params]="{ nllbUrl }"
          ></transloco>
        </p>
      </li>
      <li>
        <mat-icon *ngIf="isSourceProjectSet" class="criteria-met">check</mat-icon>
        <mat-icon *ngIf="!isSourceProjectSet" class="criteria-not-met">clear</mat-icon>
        <p *ngIf="isSourceProjectSet">{{ t("project_type_has_source_text") }}</p>
        <p *ngIf="!isSourceProjectSet">{{ t("project_type_has_no_source_text") }}</p>
      </li>
    </ul>
  </section>

  <ng-container *ngIf="isDraftJobFetched">
    <mat-divider inset></mat-divider>

    <section *ngIf="infoAlert === InfoAlert.NotBackTranslation">
      <h3><mat-icon>info</mat-icon>{{ t("project_type_not_supported") }}</h3>
      <p>{{ t("project_type_not_supported_detail") }}</p>
    </section>

    <section *ngIf="infoAlert === InfoAlert.NotSupportedLanguage">
      <h3><mat-icon>info</mat-icon>{{ t("target_language_not_supported") }}</h3>
      <transloco
        *ngIf="targetLanguageDisplayName"
        [key]="'project_language_not_in_nllb_with_language'"
        [params]="{targetLanguageDisplayName}"
      ></transloco>
      <transloco *ngIf="!targetLanguageDisplayName" [key]="'project_language_not_in_nllb'"></transloco>
    </section>

    <section *ngIf="infoAlert === InfoAlert.NoSourceProjectSet">
      <h3><mat-icon>info</mat-icon>{{ t("source_text_not_selected") }}</h3>
      <p>
        <transloco
          key="draft_generation.source_text_not_selected_detail"
          [params]="{ projectSettingsUrl: { route: projectSettingsUrl } }"
        ></transloco>
      </p>
    </section>

    <section *ngIf="infoAlert === InfoAlert.SourceAndTargetLanguageIdentical">
      <h3><mat-icon>info</mat-icon>{{ t("same_source_and_target_language") }}</h3>
      <p>{{ t("same_source_and_target_language_detail") }}</p>
    </section>

    <ng-container *ngIf="isGenerationSupported">
      <section *ngIf="draftJob == null; else jobExists">
        <h3>{{ t("generate_draft") }}</h3>
        <p><transloco key="draft_generation.generate_draft_detail"></transloco></p>

        <button mat-flat-button color="primary" (click)="generateDraft()">{{ t("generate_draft") }}</button>
      </section>

      <ng-template #jobExists>
        <section *ngIf="isDraftComplete(draftJob) || !isDraftInProgress(draftJob)" class="view-or-create-options">
          <ng-container *ngIf="isDraftComplete(draftJob)">
            <div>
              <h3>{{ t("draft_generation_complete") }}</h3>
              <p>
                <transloco
                  key="draft_generation.go_to_draft_viewer"
                  [params]="{ draftViewerUrl: { route: draftViewerUrl } }"
                ></transloco>
              </p>
              <a mat-flat-button color="primary" [routerLink]="draftViewerUrl">{{ t("preview_draft") }}</a>
            </div>

            <mat-divider inset vertical [attr.data-text]="t('or')"></mat-divider>
          </ng-container>

          <ng-container *ngIf="!isDraftComplete(draftJob) && (hasAnyCompletedBuild$ | async)">
            <div>
              <h3>{{ t("preview_last_draft") }}</h3>
              <p>
                <transloco
                  key="draft_generation.no_builds_in_progress"
                  [params]="{ draftViewerUrl: { route: draftViewerUrl } }"
                ></transloco>
              </p>
              <a mat-flat-button color="primary" [routerLink]="draftViewerUrl">{{ t("preview_draft") }}</a>
            </div>

            <mat-divider inset vertical [attr.data-text]="t('or')"></mat-divider>
          </ng-container>

          <div *ngIf="!isDraftInProgress(draftJob)">
            <h3>{{ t("generate_new_draft") }}</h3>
            <p><transloco key="draft_generation.generate_new_draft_detail"></transloco></p>

            <p>{{ t("suggested_workflow") }}</p>

            <button mat-flat-button color="primary" (click)="generateDraft(true)">{{ t("generate_draft") }}</button>
          </div>
        </section>

        <section *ngIf="isDraftQueued(draftJob)">
          <h3>{{ t("draft_queued") }}</h3>
          <p>{{ t("draft_queued_detail") }}</p>
          <app-working-animated-indicator></app-working-animated-indicator>
          <button *ngIf="canCancel(draftJob)" mat-flat-button color="primary" (click)="cancel()">
            {{ t("cancel_generation") }}
          </button>
        </section>

        <section *ngIf="isDraftActive(draftJob)" class="progress-active">
          <h3>{{ t("draft_active") }}</h3>
          <p>{{ t("draft_active_detail") }}</p>
          <circle-progress [percent]="draftJob!.percentCompleted"></circle-progress>
          <button *ngIf="canCancel(draftJob)" mat-flat-button color="primary" (click)="cancel()">
            {{ t("cancel_generation") }}
          </button>
        </section>
      </ng-template>
    </ng-container>
  </ng-container>
</mat-card>
