<ng-container *transloco="let t">
  <h2 mat-dialog-title>{{ t("chapter_audio_dialog.chapter_audio") }}</h2>
  <mat-dialog-content class="mat-typography">
    <div class="dropzone" #dropzone>
      <input type="file" multiple #fileDropzone accept=".csv,.tsv,.txt,audio/*" (change)="uploadedFiles($event)" />
      <label
        >{{ t("chapter_audio_dialog.drag_and_drop_files") }}<br />-
        {{ t("chapter_audio_dialog.drag_and_drop_or_browse") }} -</label
      >
      <button mat-flat-button color="primary" type="submit">{{ t("chapter_audio_dialog.browse_files") }}</button>
    </div>
    <div class="data-blocks">
      <div class="wrapper wrapper-book-chapter valid">
        <mat-icon *ngIf="!selectionHasAudioAlready">book</mat-icon>
        <app-info
          *ngIf="selectionHasAudioAlready"
          [text]="t('chapter_audio_dialog.audio_already_exists')"
          icon="warning"
          type="warning"
        ></app-info>
        <mat-select [(value)]="book" class="book-select-menu">
          <mat-option *ngFor="let b of books" [value]="b">{{ bookName(b) }}</mat-option>
        </mat-select>
        <div class="divider"></div>
        <mat-select [(value)]="chapter" class="chapter-select-menu">
          <mat-option *ngFor="let c of chapters" [value]="c">{{ c }}</mat-option>
        </mat-select>
      </div>
      <div class="wrapper wrapper-audio" [ngClass]="{ valid: hasAudioBeenUploaded, invalid: audioErrorMessage !== '' }">
        <ng-container *ngIf="hasAudioBeenUploaded">
          <app-single-button-audio-player
            #chapterAudio
            id="chapterAudio"
            [source]="audioBlob"
            (click)="chapterAudio.playing ? chapterAudio.stop() : chapterAudio.play()"
          >
            <mat-icon>{{ chapterAudio.playing ? "stop" : "play_arrow" }}</mat-icon>
          </app-single-button-audio-player>
          <span *ngIf="hasAudioBeenUploaded">{{ audioFilename }}</span>
          <mat-icon *ngIf="hasAudioBeenUploaded" (click)="deleteAudioData()" class="delete">delete</mat-icon>
        </ng-container>
        <ng-container *ngIf="!hasAudioBeenUploaded">
          <mat-icon>play_disabled</mat-icon>
          <span *ngIf="!hasAudioBeenUploaded">{{ t("chapter_audio_dialog.no_audio_file_uploaded") }}</span>
        </ng-container>
      </div>
      <div
        class="wrapper wrapper-timing"
        [ngClass]="{ valid: hasTimingBeenUploaded, invalid: timingErrorMessage !== '' }"
      >
        <mat-icon class="material-icons-outlined">timer</mat-icon>
        <span *ngIf="hasTimingBeenUploaded">{{
          t("chapter_audio_dialog.segments_found", { segments: numberOfTimingSegments })
        }}</span>
        <span *ngIf="!hasTimingBeenUploaded && timingErrorMessage === ''">{{
          t("chapter_audio_dialog.no_timing_data_uploaded")
        }}</span>
        <span *ngIf="!hasTimingBeenUploaded && timingErrorMessage !== ''">{{ t(timingErrorMessage) }}</span>
        <mat-icon *ngIf="hasTimingBeenUploaded" (click)="deleteTimingData()" class="delete">delete</mat-icon>
      </div>
    </div>
    <app-notice id="offline-error" *ngIf="!isOnline" [type]="'error'" [outline]="true" [icon]="'cloud_off'">
      {{ t("chapter_audio_dialog.not_upload_audio_offline") }}
    </app-notice>
  </mat-dialog-content>
  <mat-dialog-actions>
    <div class="uploading" *ngIf="isLoadingAudio">
      <span>Uploading...</span>
      <mat-spinner diameter="24"></mat-spinner>
    </div>
    <button mat-button [mat-dialog-close]="'close'" type="button" id="audio-cancel-btn">
      {{ t("chapter_audio_dialog.cancel") }}
    </button>
    <button mat-flat-button color="primary" type="submit" (click)="save()" id="audio-save-btn" [disabled]="!isOnline">
      {{ t("chapter_audio_dialog.save") }}
    </button>
  </mat-dialog-actions>
</ng-container>
