<div *ngFor="let comment of getSortedComments(); index as i">
  <div
    class="comment"
    [ngClass]="{ 'comment-unread': !hasUserReadComment(comment) }"
    *ngIf="
      (!activeComment || (commentFormVisible && activeComment.dataId !== comment.dataId)) &&
      (i + 1 < maxCommentsToShow || commentCount == maxCommentsToShow || showAllComments)
    "
  >
    <span class="comment-text">{{ comment.text }}</span> <span class="divider">-</span>
    <app-checking-owner [ownerRef]="comment.ownerRef" [dateTime]="comment.dateCreated"></app-checking-owner>
    <div class="actions">
      <button *ngIf="hasPermission(comment, 'edit')" mdc-button (click)="editComment(comment)" class="comment-edit">
        Edit
      </button>
      <button
        *ngIf="hasPermission(comment, 'delete')"
        mdc-button
        (click)="deleteComment(comment)"
        class="comment-delete"
      >
        Delete
      </button>
    </div>
  </div>
  <app-checking-comment-form
    *ngIf="commentFormVisible && activeComment && activeComment.dataId === comment.dataId"
    (save)="submit($event)"
    (cancel)="hideCommentForm()"
    [text]="comment.text"
  ></app-checking-comment-form>
</div>
<app-checking-comment-form
  *ngIf="commentFormVisible && !activeComment"
  (save)="submit($event)"
  (cancel)="hideCommentForm()"
></app-checking-comment-form>
<button
  *ngIf="!commentFormVisible && commentCount > maxCommentsToShow && !showAllComments"
  mdc-button
  (click)="showComments()"
  class="show-all-comments"
>
  {{ showMoreCommentsLabel }}
</button>
<button
  *ngIf="!commentFormVisible && (commentCount <= maxCommentsToShow || showAllComments)"
  mdc-button
  (click)="showCommentForm()"
  class="add-comment"
>
  Add a comment
</button>
