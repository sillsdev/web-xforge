<div fxLayout="row" fxLayoutAlign="start center" [ngClass]="{ 'reviewer-panels': !isProjectAdmin }">
  <mdc-icon fxFlex="32px">library_books</mdc-icon>
  <h2 fxFlex>Texts with Questions</h2>
  <div fxFlexAlign="center" *ngIf="isProjectAdmin; else overallProgressChart">
    <button *ngIf="!isLoading" mdc-button (click)="questionDialog()" id="add-question-button">
      <mdc-icon>note_add</mdc-icon> <span fxHide.xs>Add question</span>
    </button>
  </div>
  <ng-template #overallProgressChart>
    <div id="overall-progress-chart">
      <canvas
        baseChart
        width="36"
        height="36"
        chartType="doughnut"
        [legend]="false"
        [labels]="['Unread', 'Read', 'Answered']"
        [data]="overallProgress()"
        [colors]="[{ backgroundColor: ['#3a3a3a', '#edecec', '#B8D332'] }]"
        [options]="{ events: [] }"
      ></canvas>
    </div>
  </ng-template>
</div>

<div fxLayout="column" fxLayoutAlign="space-around" *ngIf="isProjectAdmin; else reviewerQuestionPanel">
  <mdc-list dense id="text-with-questions-list">
    <ng-container *ngFor="let text of texts">
      <mdc-list-item
        *ngIf="bookQuestionCount(text) > 0"
        (selectionChange)="itemVisible[text.bookId] = !itemVisible[text.bookId]"
      >
        <div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
          <mdc-icon fxFlex="24px" mdcListItemMeta>
            keyboard_arrow_{{ itemVisible[text.bookId] ? "down" : "right" }}
          </mdc-icon>
          <span fxFlex>{{ text?.name }}</span>
          <span fxFlex="80px" fxLayoutAlign="end center">{{ questionCountLabel(bookQuestionCount(text)) }}</span>
          <span fxFlex="80px" fxLayoutAlign="end center">{{ answerCountLabel(bookAnswerCount(text)) }}</span>
          <span fxFlex="64px" fxLayoutAlign="end center">&nbsp;</span>
        </div>
      </mdc-list-item>
      <ng-container *ngIf="itemVisible[text.bookId]">
        <ng-container *ngFor="let chapter of text.chapters">
          <mdc-list-item
            *ngIf="questionCount(text.bookId, chapter.number) > 0"
            (selectionChange)="
              itemVisible[getTextJsonDocIdStr(text.bookId, chapter.number)] = !itemVisible[
                getTextJsonDocIdStr(text.bookId, chapter.number)
              ]
            "
          >
            <div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
              <span fxFlex="16px" class="indent"></span>
              <mdc-icon fxFlex="24px" mdcListItemMeta>
                keyboard_arrow_{{ itemVisible[getTextJsonDocIdStr(text.bookId, chapter.number)] ? "down" : "right" }}
              </mdc-icon>
              <span fxFlex>{{ text?.name + " " + chapter?.number }}</span>
              <span fxFlex="80px" fxLayoutAlign="end center">
                {{ questionCountLabel(questionCount(text.bookId, chapter.number)) }}
              </span>
              <span fxFlex="80px" fxLayoutAlign="end center">
                {{ answerCountLabel(chapterAnswerCount(text.bookId, chapter.number)) }}
              </span>
              <span fxFlex="64px" fxLayoutAlign="end center">&nbsp;</span>
            </div>
          </mdc-list-item>
          <ng-container *ngIf="itemVisible[getTextJsonDocIdStr(text.bookId, chapter.number)]">
            <mdc-list-item *ngFor="let question of getQuestions(getTextJsonDocIdStr(text.bookId, chapter.number))">
              <div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
                <span fxFlex="16px" class="indent"></span>
                <button
                  fxFlex="64px"
                  mdc-button
                  (click)="questionDialog(true, text.bookId, chapter.number, question.id)"
                  class="edit-btn"
                >
                  <mdc-icon>edit</mdc-icon>
                </button>
                <span fxFlex class="no-overflow-ellipsis">
                  v{{ question?.scriptureStart?.verse }} - {{ question?.text }}
                </span>
                <span fxFlex="80px" fxLayoutAlign="end center">
                  {{ answerCountLabel(answerCount(text.bookId, chapter.number, question.id)) }}
                </span>
                <span fxFlex="64px" fxLayoutAlign="end center">
                  <button
                    mdc-button
                    (click)="archiveQuestion(question.id, text.bookId, chapter.number)"
                    title="Archive"
                    class="archive-btn"
                  >
                    <mdc-icon>archive</mdc-icon>
                  </button>
                </span>
              </div>
            </mdc-list-item>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  </mdc-list>
</div>

<ng-template #reviewerQuestionPanel>
  <div fxLayout="column" fxLayoutAlign="space-around" class="reviewer-panels" id="reviewer-question-panel">
    <mdc-list dense id="reviewer-questions-list">
      <ng-container *ngFor="let text of texts">
        <mdc-list-item
          *ngIf="bookQuestionCount(text) > 0"
          [routerLink]="['/projects', projectId, 'checking', text.bookId]"
        >
          <div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
            <span fxFlex>{{ text?.name }}</span>
            <span>
              <canvas
                baseChart
                width="36"
                height="36"
                chartType="doughnut"
                [legend]="false"
                [labels]="['Unread', 'Read', 'Answered']"
                [data]="bookProgress(text)"
                [colors]="[{ backgroundColor: ['#3a3a3a', '#edecec', '#B8D332'] }]"
                [options]="{ events: [] }"
              ></canvas>
            </span>
          </div>
        </mdc-list-item>
      </ng-container>
    </mdc-list>
  </div>
</ng-template>

<div fxLayout="row wrap" fxLayoutAlign="space-between" class="reviewer-panels stat-panels">
  <mdc-card class="card" outlined>
    <div class="card-content-question">
      <span fxFlex>
        <div class="stat-total">{{ allQuestionsCount }}</div>
        <div class="stat-label">Questions</div>
      </span>
      <span fxLayoutAlign="start center"> <mdc-icon>help</mdc-icon> </span>
    </div>
  </mdc-card>
  <mdc-card class="card" outlined>
    <div class="card-content-answer">
      <span fxFlex>
        <div class="stat-total">{{ myAnswerCount }}</div>
        <div class="stat-label">Answers</div>
      </span>
      <span fxLayoutAlign="start center"> <mdc-icon>question_answer</mdc-icon> </span>
    </div>
  </mdc-card>
  <mdc-card class="card" outlined>
    <div class="card-content-comment">
      <span fxFlex>
        <div class="stat-total">{{ myCommentCount }}</div>
        <div class="stat-label">Comments</div>
      </span>
      <span fxLayoutAlign="start center"> <mdc-icon>comment</mdc-icon> </span>
    </div>
  </mdc-card>
  <mdc-card class="card" outlined>
    <div class="card-content-like">
      <span fxFlex>
        <div class="stat-total">{{ myLikeCount }}</div>
        <div class="stat-label">Likes</div>
      </span>
      <span fxLayoutAlign="start center"> <mdc-icon>thumb_up</mdc-icon> </span>
    </div>
  </mdc-card>
</div>

<div fxLayout="row" fxLayoutAlign="start center" *ngIf="isProjectAdmin">
  <mdc-icon fxFlex="32px">archive</mdc-icon>
  <h2 fxFlex>Archived Questions</h2>
</div>

<div fxLayout="column" *ngIf="isProjectAdmin">
  <mdc-list dense id="text-with-archived-questions">
    <ng-container *ngFor="let text of texts">
      <mdc-list-item
        *ngIf="bookQuestionCount(text, true) > 0"
        (selectionChange)="itemVisibleArchived[text.bookId] = !itemVisibleArchived[text.bookId]"
      >
        <div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
          <mdc-icon fxFlex="24px" mdcListItemMeta
            >keyboard_arrow_{{ itemVisibleArchived[bookId] ? "down" : "right" }}</mdc-icon
          ><span fxFlex>{{ text?.name }}</span>
          <span fxFlex="80px" fxLayoutAlign="end center" class="archived-questions-count">{{
            questionCountLabel(bookQuestionCount(text, true))
          }}</span>
          <span fxFlex="64px" fxLayoutAlign="end center">&nbsp;</span>
        </div>
      </mdc-list-item>
      <ng-container *ngIf="itemVisibleArchived[text.bookId]">
        <ng-container *ngFor="let chapter of text.chapters">
          <mdc-list-item
            *ngIf="questionCount(text.bookId, chapter.number, true) > 0"
            (selectionChange)="
              itemVisibleArchived[getTextJsonDocIdStr(text.bookId, chapter.number)] = !itemVisibleArchived[
                getTextJsonDocIdStr(text.bookId, chapter.number)
              ]
            "
            ><div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
              <span fxFlex="16px" class="indent"></span>
              <mdc-icon fxFlex="24px" mdcListItemMeta
                >keyboard_arrow_{{
                  itemVisibleArchived[getTextJsonDocIdStr(text.bookId, chapter.number)] ? "down" : "right"
                }}</mdc-icon
              >
              <span fxFlex>{{ text?.name + " " + chapter?.number }}</span>
            </div>
          </mdc-list-item>
          <ng-container *ngIf="itemVisibleArchived[getTextJsonDocIdStr(text.bookId, chapter.number)]">
            <mdc-list-item
              *ngFor="let question of getQuestions(getTextJsonDocIdStr(text.bookId, chapter.number), true)"
            >
              <div fxFlex="grow" fxLayout="row" fxLayoutAlign="start center">
                <span fxFlex="40px" class="indent"></span>
                <span fxFlex class="no-overflow-ellipsis"
                  >v{{ question?.scriptureStart?.verse }} - {{ question?.text }}</span
                >
                <span fxFlex="200px" fxLayoutAlign="end center" class="date-archived"
                  >Archived {{ dateInWords(question?.dateArchived) }} ago</span
                >
                <span fxFlex="64px" fxLayoutAlign="end center">
                  <button
                    mdc-button
                    (click)="archiveQuestion(question.id, text.bookId, chapter.number)"
                    title="Republish"
                    class="publish-btn"
                  >
                    <mdc-icon>public</mdc-icon>
                  </button>
                </span>
              </div>
            </mdc-list-item>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  </mdc-list>
</div>
