<ng-container *transloco="let t; read: 'app'">
  <mat-progress-bar
    [mode]="featureFlags.stillness.enabled ? 'determinate' : 'indeterminate'"
    color="accent"
    [class.mat-progress-bar--closed]="isAppLoading !== true"
  ></mat-progress-bar>
  <header [class.overlay-drawer]="!isDrawerPermanent" [dir]="i18n.direction">
    <mat-toolbar color="primary">
      <mat-toolbar-row>
        <button mat-icon-button *ngIf="!isDrawerPermanent && isProjectSelected" (click)="toggleDrawer()">
          <mat-icon>menu</mat-icon>
        </button>
        <span (click)="goHome()" class="title">
          <button mat-icon-button>
            <img id="nav-logo" src="/assets/images/logo-sf.svg" height="24" />
          </button>
          <span fxHide.xs>{{ appName }}</span>
        </span>
        <span class="toolbar-spacer"></span>
        <button mat-icon-button title="{{ t('language') }}" [matMenuTriggerFor]="localeMenu" *ngIf="isAppOnline">
          <mat-icon>translate</mat-icon>
        </button>
        <mat-menu #localeMenu="matMenu" class="locale-menu">
          <button
            mat-menu-item
            *ngFor="let locale of i18n.locales"
            [class.active-locale]="locale.canonicalTag === i18n.localeCode"
            (click)="setLocale(locale.canonicalTag)"
          >
            <mat-icon>check</mat-icon>
            <span [class.locale-disabled]="!locale.production">{{ locale.localName }}</span>
          </button>
        </mat-menu>

        <button mat-icon-button title="{{ t('help') }}" [matMenuTriggerFor]="helpMenu">
          <mat-icon>help</mat-icon>
        </button>
        <mat-menu #helpMenu="matMenu" class="help-menu">
          <a mat-menu-item target="_blank" [href]="urls.helps">{{ t("help") }}</a>
          <a mat-menu-item target="_blank" [href]="urls.manual">{{ t("manual") }}</a>
          <a mat-menu-item target="_blank" [href]="urls.communityAnnouncementPage">{{ t("announcements") }}</a>
          <a mat-menu-item target="_blank" [href]="urls.communitySupport">{{ t("community_support") }}</a>
          <a mat-menu-item target="_blank" [href]="issueMailTo" class="report-issue">
            {{ t("report_issue") }}
            <span class="mat-hint">{{ t("report_issue_email", { email: issueEmail }) }}</span>
          </a>
          <a mat-menu-item target="_blank" href="/3rdpartylicenses.txt">{{ t("open_source_licenses") }}</a>
          <button
            *ngIf="versionNumberClickCount >= 10 || featureFlags.showFeatureFlags.enabled"
            mat-menu-item
            (click)="openFeatureFlagDialog()"
          >
            Feature flags
          </button>
          <mat-divider></mat-divider>
          <div
            mat-menu-item
            disabled="true"
            (click)="versionNumberClickCount = versionNumberClickCount + 1"
            id="version-number"
          >
            {{ t("product_version", { version: version }) }}
          </div>
        </mat-menu>

        <button mat-icon-button title="{{ currentUser?.displayName }}" [matMenuTriggerFor]="userMenu">
          <app-avatar id="avatarId" [user]="currentUser" [round]="true" [showOnlineStatus]="true"></app-avatar>
        </button>
        <mat-menu #userMenu="matMenu" class="user-menu">
          <div class="pseudo-menu-item user-info">
            <div>{{ t("logged_in_as") }}</div>
            <div class="name-and-edit-button">
              <div id="user-menu-name">{{ currentUser?.displayName }}</div>
              <button mat-icon-button (click)="editName()" id="edit-name-btn">
                <mat-icon>edit</mat-icon>
              </button>
            </div>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item *ngIf="isSystemAdmin" [disabled]="!isAppOnline" appRouterLink="/system-administration">
            {{ t("system_administration") }}
          </button>
          <button mat-menu-item appRouterLink="/projects" id="project-home-link">{{ t("project_home") }}</button>
          <button mat-menu-item *ngIf="canChangePassword" (click)="changePassword()" [disabled]="!isAppOnline">
            {{ t("change_password") }}
          </button>
          <button mat-menu-item (click)="logOut()" id="log-out-link">{{ t("log_out") }}</button>
          <mat-divider></mat-divider>
          <div class="pseudo-menu-item online-status">
            <ng-container *ngIf="isAppOnline"><mat-icon>cloud</mat-icon> {{ t("online") }}</ng-container>
            <ng-container *ngIf="!isAppOnline"><mat-icon>cloud_off</mat-icon> {{ t("offline") }}</ng-container>
          </div>
        </mat-menu>
      </mat-toolbar-row>
      <mat-toolbar-row *ngIf="hasUpdate" class="update-banner">
        <span class="refresh-message">{{ t("update_is_available") }}</span>
        <button mat-raised-button color="accent" (click)="reloadWithUpdates()">{{ t("refresh") }}</button>
      </mat-toolbar-row>
    </mat-toolbar>
  </header>
  <mdc-drawer
    id="menu-drawer"
    *ngIf="isProjectSelected"
    [drawer]="isDrawerPermanent ? 'permanent' : 'modal'"
    [open]="isExpanded"
    (closed)="drawerCollapsed()"
  >
    <mdc-drawer-header>
      <div
        [class.top-app-bar-adjust]="isDrawerPermanent"
        [class.top-app-bar-adjust-double]="hasUpdate && isDrawerPermanent"
      ></div>
      <mdc-select
        *ngIf="projectDocs != null"
        dir="auto"
        class="project-select"
        (valueChange)="projectChanged($event.value)"
      >
        <mdc-menu>
          <mdc-list>
            <mdc-list-item *ngFor="let projectDoc of projectDocs" [value]="projectDoc.id">{{
              projectLabel(projectDoc.data)
            }}</mdc-list-item>
            <mdc-list-divider></mdc-list-divider>
            <mdc-list-item [dir]="i18n.direction" value="*connect-project*" [class.list-item-disabled]="!isAppOnline">
              <mdc-icon mdcListItemGraphic>add</mdc-icon>
              {{ t("connect_project") }}
            </mdc-list-item>
          </mdc-list>
        </mdc-menu>
      </mdc-select>
    </mdc-drawer-header>
    <mdc-drawer-content>
      <app-navigation [selectedProjectDoc]="selectedProjectDoc" (menuItemClicked)="itemSelected()"></app-navigation>
    </mdc-drawer-content>
  </mdc-drawer>
  <!-- The cdkScrollable attribute is needed so the CDK can listen to scroll events within this container -->
  <div
    #appContent
    cdkScrollable
    class="app-content top-app-bar-adjust"
    [class.top-app-bar-adjust-double]="hasUpdate"
    [dir]="i18n.direction"
  >
    <div>
      <router-outlet></router-outlet>
      <p *ngIf="showCheckingDisabled" class="checking-unavailable">{{ t("scripture_checking_not_available") }}</p>
    </div>
  </div>
</ng-container>
