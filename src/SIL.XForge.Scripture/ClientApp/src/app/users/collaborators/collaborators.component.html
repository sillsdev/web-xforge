<ng-container *transloco="let t; read: 'collaborators'">
  <div class="invite-user">
    @if (!isAppOnline) {
      <p id="collaborators-offline-message" class="offline-text">{{ t("connect_network_to_manage_users") }}</p>
    }
    <app-notice icon="live_help">
      <div class="help-message">
        {{ t("member_role_info") }}
        <br /><br />
        {{ t("guest_role_info") }}
      </div>
    </app-notice>

    @if (!isLoading) {
      <div>
        @for (userList of projectUsers; track userList.userType) {
          <h2>
            {{ userList.userType === "paratext" ? t("paratext_members") : t("project_guests") }}
          </h2>
          @if (userList.rows.length > 0) {
            <div>
              <table mat-table fxFill id="{{ userList.userType }}" [dataSource]="userList.rows">
                <ng-container matColumnDef="avatar">
                  <td mat-cell *matCellDef="let userRow; let i = index">
                    @if (userRow.inviteeStatus == null && !userRow.paratextMemberNotConnected) {
                      <div>
                        <app-avatar [user]="userRow.user" [size]="32"></app-avatar>
                      </div>
                    }
                  </td>
                </ng-container>
                <ng-container matColumnDef="name">
                  <td mat-cell *matCellDef="let userRow">
                    @if (!userRow.inviteeStatus) {
                      <div class="display-name-label">
                        <div>
                          {{ userRow.user?.displayName }}
                          @if (isCurrentUser(userRow)) {
                            &nbsp;<b class="current-user-label">
                              {{ t("me") }}
                            </b>
                          }
                        </div>
                        @if (userRow.paratextMemberNotConnected) {
                          <i>{{ t("paratext_member_not_connected") }}</i>
                        }
                      </div>
                    } @else {
                      <div
                        [innerHtml]="
                          userRow.inviteeStatus.expired
                            ? i18n.translateAndInsertTags('collaborators.invitation_expired', {
                                email: userRow.user?.email
                              })
                            : i18n.translateAndInsertTags('collaborators.awaiting_response_from', {
                                email: userRow.user?.email
                              })
                        "
                      ></div>
                    }
                    <div class="hide-gt-sm">
                      <em>{{ userRow.role ? i18n.localizeRole(userRow.role) : t("role_unknown") }}</em>
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="questions_permission">
                  <td mat-cell *matCellDef="let userRow">
                    @if (userRow.allowCreatingQuestions) {
                      <div [matTooltip]="t('allow_add_edit_questions')">
                        <mat-icon>post_add</mat-icon>
                      </div>
                    }
                  </td>
                </ng-container>
                <ng-container matColumnDef="audio_permission">
                  <td mat-cell *matCellDef="let userRow">
                    @if (userRow.canManageAudio) {
                      <div [matTooltip]="t('allow_manage_audio')">
                        <mat-icon class="shift-left material-icons-outlined">audio_file</mat-icon>
                      </div>
                    }
                  </td>
                </ng-container>
                <ng-container matColumnDef="role">
                  <td class="hide-lt-sm" mat-cell *matCellDef="let userRow">
                    <em>{{ userRow.role ? i18n.localizeRole(userRow.role) : t("role_unknown") }}</em>
                  </td>
                </ng-container>
                <ng-container matColumnDef="more">
                  <td mat-cell *matCellDef="let userRow">
                    @if (!userRow.paratextMemberNotConnected) {
                      <button mat-icon-button class="user-more-menu" [matMenuTriggerFor]="userOptions">
                        <mat-icon>more_vert</mat-icon>
                      </button>
                    }
                    <mat-menu #userOptions="matMenu" class="user-options">
                      @if (!userRow.inviteeStatus && !isCurrentUser(userRow)) {
                        <button
                          mat-menu-item
                          class="remove-user"
                          (click)="removeProjectUserClicked(userRow)"
                          [disabled]="!isAppOnline"
                        >
                          {{ t("remove_from_project") }}
                        </button>
                      } @else if (userRow.inviteeStatus) {
                        <button
                          mat-menu-item
                          class="cancel-invite"
                          (click)="uninviteProjectUser(userRow.user.email)"
                          [disabled]="!isAppOnline"
                        >
                          {{ t("cancel_invite") }}
                        </button>
                      }
                      <button
                        mat-menu-item
                        (click)="openRolesDialog(userRow)"
                        [disabled]="isAdmin(userRow.role) || userRow.inviteeStatus"
                        data-test-id="edit-roles-and-permissions"
                      >
                        {{ t("edit_roles_and_permissions") }}
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>
                <tr mat-row *matRowDef="let userRow; columns: tableColumns"></tr>
              </table>
            </div>
          } @else {
            <mat-hint class="no-users-label" id="{{ `no-users-${userList.userType}`}}">{{
              t("no_users_found")
            }}</mat-hint>
          }
        }
      </div>
    }
    <app-share-control [projectId]="projectId" (invited)="onInvitationSent()"></app-share-control>
  </div>
</ng-container>
