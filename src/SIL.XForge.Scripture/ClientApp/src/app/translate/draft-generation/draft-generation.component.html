<mat-card *transloco="let t; read: 'draft_generation'">
  <h1 mat-card-title>{{ t("generate_back_translation_drafts") }}</h1>

  <mat-divider inset></mat-divider>

  <section>
    <p>{{ t("scripture_forge_assist") }}</p>
    <p><transloco key="draft_generation.keep_in_mind"></transloco></p>
    <p>{{ t("back_translation_process") }}</p>

    <h3 class="requirements-header">{{ t("requirements") }}</h3>
    <ul class="requirements">
      <li>
        <mat-icon [ngClass]="{ 'criteria-met': isTargetLanguageNllb, 'criteria-not-met': !isTargetLanguageNllb }">{{
          isTargetLanguageNllb ? "check" : "clear"
        }}</mat-icon>
        <p>
          <transloco
            [key]="
              'draft_generation.project_language_' +
              (!isTargetLanguageNllb ? 'not_' : '') +
              'in_nllb' +
              (targetLanguageDisplayName ? '_with_language' : '')
            "
            [params]="{ targetLanguageDisplayName, nllbUrl }"
          ></transloco>
        </p>
      </li>
      <li>
        <mat-icon [ngClass]="{ 'criteria-met': isBackTranslation, 'criteria-not-met': !isBackTranslation }">{{
          isBackTranslation ? "check" : "clear"
        }}</mat-icon>
        <p *ngIf="isBackTranslation">{{ t("project_type_back_translation") }}</p>
        <p *ngIf="!isBackTranslation">{{ t("project_type_not_back_translation") }}</p>
      </li>
      <li>
        <mat-icon [ngClass]="{ 'criteria-met': isSourceProjectSet, 'criteria-not-met': !isSourceProjectSet }">{{
          isSourceProjectSet ? "check" : "clear"
        }}</mat-icon>
        <p *ngIf="isSourceProjectSet">Your project has source text selected.</p>
        <p *ngIf="!isSourceProjectSet">Your project has no source text selected.</p>
      </li>
    </ul>
  </section>

  <ng-container *ngIf="isReady">
    <mat-divider inset></mat-divider>

    <section *ngIf="!isBackTranslation">
      <h3><mat-icon>info</mat-icon>{{ t("project_type_not_supported") }}</h3>
      <p>{{ t("project_type_not_supported_detail") }}</p>
    </section>

    <section *ngIf="isBackTranslation && !isTargetLanguageNllb">
      <h3><mat-icon>info</mat-icon>{{ t("target_language_not_supported") }}</h3>
      <transloco
        *ngIf="targetLanguageDisplayName"
        [key]="'project_language_not_in_nllb_with_language'"
        [params]="{targetLanguageDisplayName}"
      ></transloco>
      <transloco *ngIf="!targetLanguageDisplayName" [key]="'project_language_not_in_nllb'"></transloco>
    </section>

    <section *ngIf="isBackTranslation && isTargetLanguageNllb && !isSourceProjectSet">
      <h3><mat-icon>info</mat-icon>Source text not selected</h3>
      <p>
        A source text has not been selected for this project. You can select a source text in
        <a [routerLink]="projectSettingsUrl">project settings</a>.
      </p>
    </section>

    <ng-container *ngIf="isGenerationSupported()">
      <section *ngIf="draftJob == null; else jobExists">
        <h3>{{ t("generate_draft") }}</h3>
        <p><transloco key="draft_generation.generate_draft_detail"></transloco></p>

        <button mat-flat-button color="primary" (click)="generateDraft()">{{ t("generate_draft") }}</button>
      </section>

      <ng-template #jobExists>
        <section *ngIf="isDraftComplete(draftJob) || !isDraftInProgress(draftJob)" class="view-or-create-options">
          <ng-container *ngIf="isDraftComplete(draftJob)">
            <div>
              <h3>{{ t("draft_generation_complete") }}</h3>
              <p>
                <transloco
                  key="draft_generation.go_to_draft_viewer"
                  [params]="{ draftViewerUrl: { route: draftViewerUrl } }"
                ></transloco>
              </p>
              <a mat-flat-button color="primary" [routerLink]="draftViewerUrl">{{ t("preview_draft") }}</a>
            </div>

            <mat-divider inset vertical [attr.data-text]="t('or')"></mat-divider>
          </ng-container>

          <ng-container *ngIf="!isDraftComplete(draftJob) && (hasAnyCompletedBuild$ | async)">
            <div>
              <h3>{{ t("preview_last_draft") }}</h3>
              <p>
                <transloco
                  key="draft_generation.no_builds_in_progress"
                  [params]="{ draftViewerUrl: { route: draftViewerUrl } }"
                ></transloco>
              </p>
              <a mat-flat-button color="primary" [routerLink]="draftViewerUrl">{{ t("preview_draft") }}</a>
            </div>

            <mat-divider inset vertical [attr.data-text]="t('or')"></mat-divider>
          </ng-container>

          <div *ngIf="!isDraftInProgress(draftJob)">
            <h3>{{ t("generate_new_draft") }}</h3>
            <p><transloco key="draft_generation.generate_new_draft_detail"></transloco></p>

            <p>{{ t("suggested_workflow") }}</p>

            <button mat-flat-button color="primary" (click)="generateDraft(true)">{{ t("generate_draft") }}</button>
          </div>
        </section>

        <section *ngIf="isDraftQueued(draftJob)">
          <h3>{{ t("draft_queued") }}</h3>
          <p>{{ t("draft_queued_detail") }}</p>
          <app-working-animated-indicator></app-working-animated-indicator>
          <button *ngIf="canCancel(draftJob)" mat-flat-button color="primary" (click)="cancel()">
            {{ t("cancel_generation") }}
          </button>
        </section>

        <section *ngIf="isDraftActive(draftJob)" class="progress-active">
          <h3>{{ t("draft_active") }}</h3>
          <p>{{ t("draft_active_detail") }}</p>
          <circle-progress [percent]="draftJob!.percentCompleted"></circle-progress>
          <button *ngIf="canCancel(draftJob)" mat-flat-button color="primary" (click)="cancel()">
            {{ t("cancel_generation") }}
          </button>
        </section>
      </ng-template>
    </ng-container>
  </ng-container>
</mat-card>
