@if (isLoading) {
  <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
}

<ng-container *transloco="let t; read: 'draft_apply_dialog'">
  <h2 mat-dialog-title>{{ t("select_alternate_project") }}</h2>
  <div mat-dialog-content>
    <form [formGroup]="addToProjectForm">
      <app-project-select
        [projects]="projects"
        [placeholder]="t('choose_project')"
        [isDisabled]="projects.length === 0"
        (projectSelect)="projectSelectedAsync($event.paratextId)"
        formControlName="targetParatextId"
      ></app-project-select>
      @if (!isAppOnline) {
        <mat-error class="offline-message">{{ t("connect_to_the_internet") }}</mat-error>
      } @else if (!targetBookExists) {
        <mat-error class="book-does-not-exist">{{ t("book_does_not_exist", { bookName }) }}</mat-error>
      } @else if (!canEditProject) {
        <mat-error class="cannot-edit-message">{{ t("no_write_permission") }}</mat-error>
      }
      @if (connectOtherProject != null) {
        <div class="unlisted-project-message">
          <p>
            <span [innerHTML]="connectOtherProject.before"></span>
            <a [appRouterLink]="['projects']" (click)="close()">{{ connectOtherProject.templateTagText }}</a>
            <span>{{ connectOtherProject.after }}</span>
          </p>
        </div>
      }
      @if (targetProject$ | async; as project) {
        <div class="target-project-content">
          @if (targetChapters$ | async; as chapters) {
            <mat-icon class="no-shrink">warning</mat-icon>
            {{ t("project_has_text_in_chapters", { bookName, numChapters: chapters, projectName: project.name }) }}
          } @else {
            <mat-icon class="no-shrink">verified</mat-icon>
            {{ t("book_is_empty", { bookName, projectName: project.name }) }}
          }
        </div>
        <mat-checkbox class="overwrite-content" formControlName="overwrite">{{
          t("i_understand_overwrite_book", { projectName: project.name, bookName })
        }}</mat-checkbox>
        <mat-error class="form-error" [ngClass]="{ visible: addToProjectClicked && !overwriteConfirmed }">{{
          t("confirm_overwrite")
        }}</mat-error>
      }
    </form>
  </div>
  <div mat-dialog-actions>
    <button mat-button class="cancel-button" [mat-dialog-close]="false">{{ t("cancel") }}</button>
    <button mat-raised-button class="add-button" color="primary" (click)="addToProject()">
      {{ t("add_to_project") }}
    </button>
  </div>
</ng-container>
