<ng-container *transloco="let t; read: 'checking'">
  <div id="projects-app" class="flex-max">
    <div id="checking-app-container" class="d-flex flex-fill flex-nowrap">
      <div id="questions-panel" #questionsPanel [ngClass]="{ 'overlay-visible': isQuestionsOverlayVisible }">
        <header [ngClass]="{ 'filter-applied': isQuestionFilterApplied }">
          <div class="header-main">
            <h2>
              {{ t("questions") }} <span>({{ totalVisibleQuestionsString }})</span>
            </h2>
            <button mat-icon-button [matMenuTriggerFor]="questionFilterMenu">
              <mat-icon [ngClass]="{ 'material-icons-outlined': !isQuestionFilterApplied }">filter_alt</mat-icon>
            </button>
            <mat-menu #questionFilterMenu xPosition="before">
              <mat-selection-list [multiple]="false" id="question-filter-list">
                <h2 matSubheader>{{ t("filter_questions") }}</h2>
                <mat-list-option
                  *ngFor="let f of questionFilters | keyvalue"
                  [selected]="f.key === questionFilterSelected"
                  (click)="setQuestionFilter(f.key)"
                  >{{ t(f.value) }}</mat-list-option
                >
              </mat-selection-list>
            </mat-menu>
            <button mat-icon-button class="questions-overlay-close" (click)="setQuestionsOverlayVisibility(false)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div *ngIf="isQuestionFilterApplied" class="active-question-filter">
            {{ t("filter") }}: {{ t(appliedQuestionFilterKey) }}
          </div>
        </header>
        <div class="panel-content">
          <app-checking-questions
            #questionsList
            (update)="questionUpdated($event)"
            (changed)="questionChanged($event)"
            [visible]="isQuestionListPermanent || isQuestionsOverlayVisible"
            [projectUserConfigDoc]="projectUserConfigDoc"
            [projectProfileDoc]="projectDoc"
            [questionDocs]="visibleQuestions"
            [isAllBooksShown]="showAllBooks"
          ></app-checking-questions>
        </div>
      </div>
      <div id="text-panel">
        <div class="flex-max" id="scripture-panel">
          <div class="panel">
            <div class="panel-heading">
              <div class="panel-nav">
                <div #textNameAnchor mdcMenuSurfaceAnchor>
                  <h2
                    class="chapter-select"
                    (click)="showAllBooks ? openScriptureChooser() : (chapterMenu.open = !chapterMenu.open)"
                  >
                    <span>{{ bookName }}</span>
                    <span class="chapter-dropdown">
                      {{ chapter }} <mdc-icon *ngIf="!chapterMenu.open">keyboard_arrow_down</mdc-icon
                      ><mdc-icon *ngIf="chapterMenu.open">keyboard_arrow_up</mdc-icon>
                    </span>
                  </h2>
                  <mdc-menu
                    #chapterMenu
                    anchorCorner="bottomStart"
                    [anchorElement]="textNameAnchor"
                    (selected)="onChapterSelect($event)"
                    (opened)="chapterMenuOpened()"
                  >
                    <mdc-list #chapterMenuList class="chapter-menu-list">
                      <mdc-list-item *ngFor="let cs of chapterStrings" [value]="cs"
                        >{{ bookName }} {{ cs }}</mdc-list-item
                      >
                    </mdc-list>
                  </mdc-menu>
                </div>
                <div class="action-icons">
                  <ng-container *ngIf="canCreateQuestions">
                    <button
                      fxHide
                      fxShow.lt-xl
                      mat-icon-button
                      type="button"
                      title="{{ t('add_question') }}"
                      (click)="questionDialog()"
                      class="add-question-button"
                    >
                      <mat-icon class="mirror-rtl">post_add</mat-icon>
                    </button>
                    <button
                      fxHide.lt-xl
                      mat-button
                      type="button"
                      (click)="questionDialog()"
                      class="add-question-button"
                    >
                      <mat-icon class="mirror-rtl">post_add</mat-icon>
                      <span>{{ t("add_question") }}</span>
                    </button>
                    <button
                      *ngIf="featureFlags.scriptureAudio.enabled && !chapterHasAudio"
                      type="button"
                      mat-icon-button
                      (click)="addAudioTimingData()"
                    >
                      <mat-icon>audiotrack</mat-icon>
                    </button>
                  </ng-container>
                  <button
                    *ngIf="featureFlags.scriptureAudio.enabled && chapterHasAudio"
                    type="button"
                    mat-icon-button
                    (click)="toggleAudio()"
                  >
                    <mat-icon>{{ isAudioPlaying() ? "pause" : "play_arrow" }}</mat-icon>
                  </button>
                  <app-font-size (apply)="applyFontChange($event)"></app-font-size>
                  <app-share-button *ngIf="canShare" [defaultRole]="defaultShareRole"></app-share-button>
                </div>
              </div>
            </div>
            <div id="split-container" #splitContainer>
              <as-split
                direction="vertical"
                [disabled]="!questionsList.activeQuestionDoc"
                (dragEnd)="checkSliderPosition($event)"
                [useTransition]="true"
              >
                <as-split-area [size]="100">
                  <div class="panel-content" #scripturePanelContainer>
                    <!-- TODO (scripture audio) Instead of covering scripture panel, move the audio player below it -->
                    <div class="scripture-audio-player-wrapper" *ngIf="showScriptureAudioPlayer">
                      <app-checking-scripture-audio-player
                        [source]="chapterAudioSource"
                        [timing]="chapterTextAudioTiming"
                        [textDocId]="textDocId"
                        (currentVerseChanged)="handleAudioTextRefChanged($event)"
                        (closed)="hideChapterAudio()"
                      ></app-checking-scripture-audio-player>
                    </div>
                    <app-checking-text
                      #textPanel
                      [id]="textDocId"
                      [fontSize]="scriptureFontSize"
                      [activeVerse]="activeQuestionVerseRef"
                      [questionVerses]="questionVerseRefs"
                      (questionVerseSelected)="verseRefClicked($event)"
                      [isRightToLeft]="isRightToLeft"
                    ></app-checking-text>
                  </div>
                </as-split-area>
                <as-split-area [size]="0">
                  <div *ngIf="questionsList.activeQuestionDoc" id="answer-panel" #answerPanelContainer>
                    <app-checking-answers
                      #answersPanel
                      [checkingTextComponent]="textPanel"
                      [projectProfileDoc]="projectDoc"
                      [textsByBookId]="textsByBookId"
                      [questionDoc]="questionsList.activeQuestionDoc"
                      [projectUserConfigDoc]="projectUserConfigDoc"
                      (action)="answerAction($event)"
                      (commentAction)="commentAction($event)"
                    ></app-checking-answers>
                  </div>
                </as-split-area>
              </as-split>
            </div>
          </div>
        </div>
        <div *ngIf="projectDoc" id="project-navigation">
          <button
            mat-button
            *ngIf="!this.isQuestionListPermanent"
            type="button"
            (click)="setQuestionsOverlayVisibility(true)"
          >
            {{ t("view_questions") }}
          </button>
          <div class="d-flex justify-content-end">
            <button
              mat-button
              fxHide.xs
              type="button"
              (click)="questionsList.previousQuestion()"
              [disabled]="!questionsList.checkCanChangeQuestion(-1)"
              class="prev-question"
            >
              <mat-icon>chevron_{{ i18n.backwardDirectionWord }}</mat-icon
              >{{ t("previous") }}
            </button>
            <button
              mat-button
              fxHide.xs
              type="button"
              (click)="questionsList.nextQuestion()"
              [disabled]="!questionsList.checkCanChangeQuestion(1)"
              class="next-question"
            >
              {{ t("next") }}<mat-icon>chevron_{{ i18n.forwardDirectionWord }}</mat-icon>
            </button>
            <button
              mat-icon-button
              fxHide.gt-xs
              type="button"
              (click)="questionsList.previousQuestion()"
              [disabled]="!questionsList.checkCanChangeQuestion(-1)"
              class="prev-question"
            >
              <mat-icon>chevron_{{ i18n.backwardDirectionWord }}</mat-icon>
            </button>
            <button
              mat-icon-button
              fxHide.gt-xs
              type="button"
              (click)="questionsList.nextQuestion()"
              [disabled]="!questionsList.checkCanChangeQuestion(1)"
              class="next-question"
            >
              <mat-icon>chevron_{{ i18n.forwardDirectionWord }}</mat-icon>
            </button>
            <a [appRouterLink]="routerLink" id="project-summary">
              <app-donut-chart
                [colors]="['#3a3a3a', '#fff', '#B8D332']"
                [data]="[summary.unread, summary.read, summary.answered]"
              ></app-donut-chart>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>
